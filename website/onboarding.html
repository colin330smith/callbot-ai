<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Set Up Your AI Agent | CallBot AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
                    colors: {
                        primary: {
                            50: '#eef2ff', 100: '#e0e7ff', 200: '#c7d2fe', 300: '#a5b4fc',
                            400: '#818cf8', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca',
                            800: '#3730a3', 900: '#312e81',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', system-ui, sans-serif; }
        .toggle-checkbox:checked { right: 0; border-color: #4f46e5; }
        .toggle-checkbox:checked + .toggle-label { background-color: #4f46e5; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen antialiased">
    <!-- Header -->
    <nav class="bg-white border-b border-gray-100">
        <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-center items-center h-16">
                <a href="/" class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-primary-600 rounded-lg flex items-center justify-center">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                        </svg>
                    </div>
                    <span class="text-xl font-semibold text-gray-900">CallBot AI</span>
                </a>
            </div>
        </div>
    </nav>

    <div class="max-w-2xl mx-auto px-4 py-8 sm:py-12">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-900">Set up your AI agent</h1>
            <p class="mt-2 text-gray-600">This takes about 3 minutes</p>
        </div>

        <!-- Progress Bar -->
        <div class="mb-8">
            <!-- Continuous Progress Bar -->
            <div class="relative">
                <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div id="progressBar" class="h-full bg-gradient-to-r from-primary-500 to-primary-600 rounded-full transition-all duration-500 ease-out" style="width: 20%"></div>
                </div>
                <div class="flex justify-between mt-3">
                    <span id="progressText" class="text-sm font-medium text-primary-600">Step 1 of 5</span>
                    <span id="progressPercent" class="text-sm font-medium text-gray-500">20%</span>
                </div>
            </div>
            <!-- Step Labels -->
            <div class="flex justify-between mt-4 px-2">
                <div class="step-label text-center" data-step="1">
                    <div class="w-8 h-8 rounded-full bg-primary-600 text-white flex items-center justify-center text-xs font-semibold mx-auto">1</div>
                    <span class="text-xs font-medium mt-1 block text-primary-600">Business</span>
                </div>
                <div class="step-label text-center" data-step="2">
                    <div class="w-8 h-8 rounded-full bg-gray-200 text-gray-400 flex items-center justify-center text-xs font-semibold mx-auto">2</div>
                    <span class="text-xs font-medium mt-1 block text-gray-400">Services</span>
                </div>
                <div class="step-label text-center" data-step="3">
                    <div class="w-8 h-8 rounded-full bg-gray-200 text-gray-400 flex items-center justify-center text-xs font-semibold mx-auto">3</div>
                    <span class="text-xs font-medium mt-1 block text-gray-400">Call Mode</span>
                </div>
                <div class="step-label text-center" data-step="4">
                    <div class="w-8 h-8 rounded-full bg-gray-200 text-gray-400 flex items-center justify-center text-xs font-semibold mx-auto">4</div>
                    <span class="text-xs font-medium mt-1 block text-gray-400">Agent</span>
                </div>
                <div class="step-label text-center" data-step="5">
                    <div class="w-8 h-8 rounded-full bg-gray-200 text-gray-400 flex items-center justify-center text-xs font-semibold mx-auto">5</div>
                    <span class="text-xs font-medium mt-1 block text-gray-400">Launch</span>
                </div>
            </div>
        </div>

        <!-- Form Card -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
            <!-- Step 1: Business Info -->
            <div class="step-content p-6 sm:p-8" data-step="1">
                <div class="mb-6">
                    <h2 class="text-xl font-semibold text-gray-900">Tell us about your business</h2>
                    <p class="mt-1 text-sm text-gray-500">We'll use this to customize your AI agent.</p>
                </div>
                <div class="space-y-5">
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700 mb-1.5">Business name</label>
                        <input type="text" id="name" required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition text-gray-900"
                            placeholder="Acme Plumbing">
                    </div>
                    <div>
                        <label for="industry" class="block text-sm font-medium text-gray-700 mb-1.5">Industry</label>
                        <select id="industry" required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition text-gray-900 bg-white">
                            <option value="">Select your industry</option>
                            <option value="hvac">HVAC / Heating & Cooling</option>
                            <option value="plumbing">Plumbing</option>
                            <option value="electrical">Electrical</option>
                            <option value="roofing">Roofing</option>
                            <option value="landscaping">Landscaping</option>
                            <option value="cleaning">Cleaning Services</option>
                            <option value="dental">Dental Practice</option>
                            <option value="medical">Medical Practice</option>
                            <option value="medspa">Med Spa / Aesthetics</option>
                            <option value="legal">Law Firm</option>
                            <option value="accounting">Accounting / CPA</option>
                            <option value="realestate">Real Estate</option>
                            <option value="automotive">Auto Repair</option>
                            <option value="restaurant">Restaurant</option>
                            <option value="salon">Salon / Barbershop</option>
                            <option value="fitness">Gym / Fitness</option>
                            <option value="veterinary">Veterinary</option>
                            <option value="insurance">Insurance</option>
                            <option value="contractor">General Contractor</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label for="phone" class="block text-sm font-medium text-gray-700 mb-1.5">Business phone</label>
                        <input type="tel" id="phone"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition text-gray-900"
                            placeholder="(555) 123-4567">
                    </div>
                    <div>
                        <label for="service_area" class="block text-sm font-medium text-gray-700 mb-1.5">Service area</label>
                        <input type="text" id="service_area"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition text-gray-900"
                            placeholder="Austin, TX and surrounding areas">
                    </div>
                </div>
            </div>

            <!-- Step 2: Services (Form-based) -->
            <div class="step-content hidden p-6 sm:p-8" data-step="2">
                <div class="mb-6">
                    <h2 class="text-xl font-semibold text-gray-900">What services do you offer?</h2>
                    <p class="mt-1 text-sm text-gray-500">Select all services your business provides.</p>
                </div>
                <div id="servicesContainer" class="space-y-5">
                    <!-- Services will be populated based on industry -->
                    <div class="grid grid-cols-2 gap-3" id="serviceCheckboxes">
                        <!-- Dynamic checkboxes -->
                    </div>
                    <div>
                        <label for="other_services" class="block text-sm font-medium text-gray-700 mb-1.5">Other services (comma-separated)</label>
                        <input type="text" id="other_services"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition text-gray-900"
                            placeholder="Custom service 1, Custom service 2">
                    </div>
                </div>
                <div class="mt-6 pt-6 border-t border-gray-200">
                    <h3 class="text-sm font-semibold text-gray-900 mb-4">Business hours</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="hours_weekday" class="block text-sm font-medium text-gray-700 mb-1.5">Weekdays</label>
                            <select id="hours_weekday" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition text-gray-900 bg-white">
                                <option value="8am-5pm">8:00 AM - 5:00 PM</option>
                                <option value="8am-6pm">8:00 AM - 6:00 PM</option>
                                <option value="9am-5pm">9:00 AM - 5:00 PM</option>
                                <option value="9am-6pm">9:00 AM - 6:00 PM</option>
                                <option value="7am-7pm">7:00 AM - 7:00 PM</option>
                                <option value="24/7">24/7</option>
                                <option value="closed">Closed</option>
                            </select>
                        </div>
                        <div>
                            <label for="hours_weekend" class="block text-sm font-medium text-gray-700 mb-1.5">Weekends</label>
                            <select id="hours_weekend" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition text-gray-900 bg-white">
                                <option value="closed">Closed</option>
                                <option value="9am-2pm">9:00 AM - 2:00 PM</option>
                                <option value="9am-5pm">9:00 AM - 5:00 PM</option>
                                <option value="10am-4pm">10:00 AM - 4:00 PM</option>
                                <option value="by-appointment">By Appointment</option>
                                <option value="24/7">24/7</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Call Mode Selection -->
            <div class="step-content hidden p-6 sm:p-8" data-step="3">
                <div class="mb-6">
                    <h2 class="text-xl font-semibold text-gray-900">How should AI handle your calls?</h2>
                    <p class="mt-1 text-sm text-gray-500">Choose how you want CallBot AI to work with your existing phone.</p>
                </div>
                <div class="space-y-5">
                    <!-- Call Mode Selection -->
                    <div class="space-y-4">
                        <!-- Call Forwarding Option -->
                        <label class="call-mode-option relative flex p-5 border-2 border-primary-500 bg-primary-50 rounded-xl cursor-pointer transition" data-mode="forwarding">
                            <input type="radio" name="call_mode" value="forwarding" checked class="sr-only">
                            <div class="flex-1">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-base font-semibold text-gray-900">Call Forwarding</span>
                                    <span class="px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full">Recommended</span>
                                </div>
                                <p class="text-sm text-gray-600 mb-3">AI catches calls only when you don't answer. Your phone rings first, and if you miss it, AI picks up before voicemail.</p>
                                <div class="flex items-center text-sm text-gray-500">
                                    <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                                    Keep your existing number
                                </div>
                                <div class="flex items-center text-sm text-gray-500 mt-1">
                                    <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                                    Answer calls yourself when available
                                </div>
                                <div class="flex items-center text-sm text-gray-500 mt-1">
                                    <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                                    AI only answers missed calls
                                </div>
                            </div>
                            <svg class="w-6 h-6 text-primary-600 ml-4 check-icon" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                        </label>

                        <!-- Call Takeover Option -->
                        <label class="call-mode-option relative flex p-5 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-gray-300 transition" data-mode="takeover">
                            <input type="radio" name="call_mode" value="takeover" class="sr-only">
                            <div class="flex-1">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-base font-semibold text-gray-900">Full Takeover</span>
                                    <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded-full">Hands-free</span>
                                </div>
                                <p class="text-sm text-gray-600 mb-3">AI handles ALL calls. Every call goes directly to your AI agent. Perfect if you want to focus 100% on fieldwork.</p>
                                <div class="flex items-center text-sm text-gray-500">
                                    <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                                    Zero interruptions
                                </div>
                                <div class="flex items-center text-sm text-gray-500 mt-1">
                                    <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                                    AI handles everything
                                </div>
                                <div class="flex items-center text-sm text-gray-500 mt-1">
                                    <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                                    Get notifications for urgent calls
                                </div>
                            </div>
                            <svg class="w-6 h-6 text-primary-600 ml-4 check-icon hidden" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                        </label>
                    </div>

                    <!-- Emergency Dispatch Section -->
                    <div class="pt-6 border-t border-gray-200">
                        <div class="flex items-center justify-between p-4 bg-orange-50 rounded-xl border border-orange-200">
                            <div class="flex-1">
                                <div class="flex items-center">
                                    <svg class="w-5 h-5 text-orange-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                                    </svg>
                                    <p class="text-sm font-semibold text-gray-900">Emergency Dispatch Mode</p>
                                </div>
                                <p class="text-sm text-gray-600 mt-1 ml-7">For urgent calls, AI stays on the line with the customer while simultaneously reaching out to your on-call team.</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer ml-4">
                                <input type="checkbox" id="emergency_dispatch" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-orange-100 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-500"></div>
                            </label>
                        </div>

                        <!-- On-call workers (shown when emergency dispatch is enabled) -->
                        <div id="onCallSection" class="hidden mt-4 space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1.5">On-call worker phones (comma-separated)</label>
                                <input type="text" id="oncall_phones"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition text-gray-900"
                                    placeholder="(555) 111-2222, (555) 333-4444">
                                <p class="mt-1.5 text-sm text-gray-500">AI will call these numbers in order during emergencies while keeping the customer on the line.</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1.5">Emergency keywords (what triggers dispatch)</label>
                                <input type="text" id="emergency_keywords"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition text-gray-900"
                                    placeholder="emergency, urgent, flooding, no heat, burst pipe">
                            </div>
                        </div>
                    </div>

                    <!-- Forwarding number (for forwarding mode) -->
                    <div id="forwardingSection" class="pt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1.5">Number of rings before AI answers</label>
                        <select id="rings_before_ai" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition text-gray-900 bg-white">
                            <option value="2">2 rings (~10 seconds)</option>
                            <option value="3" selected>3 rings (~15 seconds)</option>
                            <option value="4">4 rings (~20 seconds)</option>
                            <option value="5">5 rings (~25 seconds)</option>
                        </select>
                        <p class="mt-1.5 text-sm text-gray-500">How long your phone rings before AI picks up.</p>
                    </div>
                </div>
            </div>

            <!-- Step 4: Agent Configuration -->
            <div class="step-content hidden p-6 sm:p-8" data-step="4">
                <div class="mb-6">
                    <h2 class="text-xl font-semibold text-gray-900">Customize your AI agent</h2>
                    <p class="mt-1 text-sm text-gray-500">Choose how your AI introduces itself to callers.</p>
                </div>
                <div class="space-y-6">
                    <div>
                        <label for="agent_name" class="block text-sm font-medium text-gray-700 mb-1.5">Agent name</label>
                        <select id="agent_name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition text-gray-900 bg-white">
                            <option value="Alex">Alex</option>
                            <option value="Sam">Sam</option>
                            <option value="Jordan">Jordan</option>
                            <option value="Taylor">Taylor</option>
                            <option value="Morgan">Morgan</option>
                            <option value="Casey">Casey</option>
                            <option value="Riley">Riley</option>
                        </select>
                        <p class="mt-1.5 text-sm text-gray-500">The name your AI will use when answering calls.</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">Voice</label>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            <label class="relative flex items-center p-4 border-2 border-primary-500 bg-primary-50 rounded-xl cursor-pointer voice-option" data-voice="rachel">
                                <input type="radio" name="agent_voice" value="rachel" checked class="sr-only">
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm font-semibold text-gray-900">Rachel</span>
                                        <svg class="w-5 h-5 text-primary-600 check-icon" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                        </svg>
                                    </div>
                                    <span class="text-sm text-gray-500">Warm, professional female</span>
                                </div>
                            </label>
                            <label class="relative flex items-center p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-gray-300 transition voice-option" data-voice="adam">
                                <input type="radio" name="agent_voice" value="adam" class="sr-only">
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm font-semibold text-gray-900">Adam</span>
                                        <svg class="w-5 h-5 text-primary-600 check-icon hidden" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                        </svg>
                                    </div>
                                    <span class="text-sm text-gray-500">Professional male</span>
                                </div>
                            </label>
                            <label class="relative flex items-center p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-gray-300 transition voice-option" data-voice="sarah">
                                <input type="radio" name="agent_voice" value="sarah" class="sr-only">
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm font-semibold text-gray-900">Sarah</span>
                                        <svg class="w-5 h-5 text-primary-600 check-icon hidden" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                        </svg>
                                    </div>
                                    <span class="text-sm text-gray-500">Friendly, upbeat female</span>
                                </div>
                            </label>
                            <label class="relative flex items-center p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-gray-300 transition voice-option" data-voice="josh">
                                <input type="radio" name="agent_voice" value="josh" class="sr-only">
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm font-semibold text-gray-900">Josh</span>
                                        <svg class="w-5 h-5 text-primary-600 check-icon hidden" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                        </svg>
                                    </div>
                                    <span class="text-sm text-gray-500">Casual, approachable male</span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div>
                        <label for="appointment_types" class="block text-sm font-medium text-gray-700 mb-3">Appointment types your AI can book</label>
                        <div class="grid grid-cols-2 gap-2" id="appointmentTypes">
                            <label class="flex items-center p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition">
                                <input type="checkbox" value="service-call" class="appointment-type rounded border-gray-300 text-primary-600 focus:ring-primary-500" checked>
                                <span class="ml-2 text-sm text-gray-700">Service call</span>
                            </label>
                            <label class="flex items-center p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition">
                                <input type="checkbox" value="estimate" class="appointment-type rounded border-gray-300 text-primary-600 focus:ring-primary-500" checked>
                                <span class="ml-2 text-sm text-gray-700">Free estimate</span>
                            </label>
                            <label class="flex items-center p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition">
                                <input type="checkbox" value="consultation" class="appointment-type rounded border-gray-300 text-primary-600 focus:ring-primary-500">
                                <span class="ml-2 text-sm text-gray-700">Consultation</span>
                            </label>
                            <label class="flex items-center p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition">
                                <input type="checkbox" value="maintenance" class="appointment-type rounded border-gray-300 text-primary-600 focus:ring-primary-500">
                                <span class="ml-2 text-sm text-gray-700">Maintenance</span>
                            </label>
                            <label class="flex items-center p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition">
                                <input type="checkbox" value="emergency" class="appointment-type rounded border-gray-300 text-primary-600 focus:ring-primary-500">
                                <span class="ml-2 text-sm text-gray-700">Emergency</span>
                            </label>
                            <label class="flex items-center p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition">
                                <input type="checkbox" value="follow-up" class="appointment-type rounded border-gray-300 text-primary-600 focus:ring-primary-500">
                                <span class="ml-2 text-sm text-gray-700">Follow-up</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 5: Notifications & Launch -->
            <div class="step-content hidden p-6 sm:p-8" data-step="5">
                <div class="mb-6">
                    <h2 class="text-xl font-semibold text-gray-900">Almost done!</h2>
                    <p class="mt-1 text-sm text-gray-500">Set up notifications to stay informed about calls.</p>
                </div>
                <div class="space-y-5">
                    <div>
                        <label for="notification_email" class="block text-sm font-medium text-gray-700 mb-1.5">Notification email</label>
                        <input type="email" id="notification_email"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition text-gray-900"
                            placeholder="you@business.com">
                        <p class="mt-1.5 text-sm text-gray-500">Get call summaries and appointment bookings sent here.</p>
                    </div>
                    <div>
                        <label for="notification_phone" class="block text-sm font-medium text-gray-700 mb-1.5">
                            SMS notifications <span class="text-gray-400 font-normal">(optional)</span>
                        </label>
                        <input type="tel" id="notification_phone"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition text-gray-900"
                            placeholder="(555) 123-4567">
                        <p class="mt-1.5 text-sm text-gray-500">Get instant text alerts for each call.</p>
                    </div>

                    <div class="pt-5 border-t border-gray-200">
                        <h3 class="text-sm font-semibold text-gray-900 mb-3">Summary</h3>
                        <div id="summary" class="bg-gray-50 rounded-xl p-4 space-y-2">
                            <!-- Filled by JS -->
                        </div>
                    </div>

                    <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
                        <div class="flex">
                            <svg class="w-5 h-5 text-blue-600 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <div class="ml-3">
                                <p class="text-sm font-medium text-blue-800">AI Disclosure</p>
                                <p class="text-sm text-blue-700 mt-1">Your AI will identify itself as an AI assistant to all callers for transparency and compliance.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <div class="px-6 sm:px-8 py-5 bg-gray-50 border-t border-gray-200 flex justify-between items-center">
                <button id="prevBtn" class="px-5 py-2.5 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-white transition hidden">
                    Back
                </button>
                <div class="flex-1"></div>
                <button id="nextBtn" class="px-6 py-2.5 bg-primary-600 text-white rounded-lg text-sm font-medium hover:bg-primary-700 focus:ring-4 focus:ring-primary-100 transition">
                    Continue
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Modal -->
    <div id="loadingModal" class="fixed inset-0 bg-gray-900/50 backdrop-blur-sm flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-2xl p-8 max-w-sm w-full mx-4 text-center shadow-xl">
            <div class="w-16 h-16 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Creating your AI agent...</h3>
            <p class="text-sm text-gray-500">This takes about 10 seconds</p>
        </div>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 5;
        let businessId = null;
        let formData = {};

        // Industry-specific services
        const industryServices = {
            hvac: ['AC Repair', 'AC Installation', 'Heating Repair', 'Furnace Installation', 'Duct Cleaning', 'Maintenance Plans', 'Indoor Air Quality', 'Thermostat Installation'],
            plumbing: ['Drain Cleaning', 'Leak Repair', 'Water Heater Service', 'Pipe Repair', 'Sewer Line Service', 'Fixture Installation', 'Emergency Plumbing', 'Repiping'],
            electrical: ['Electrical Repair', 'Panel Upgrades', 'Outlet Installation', 'Lighting Installation', 'Ceiling Fan Installation', 'Generator Installation', 'EV Charger Installation', 'Safety Inspections'],
            roofing: ['Roof Repair', 'Roof Replacement', 'Roof Inspection', 'Gutter Installation', 'Leak Repair', 'Storm Damage Repair', 'Commercial Roofing', 'Roof Maintenance'],
            landscaping: ['Lawn Care', 'Landscape Design', 'Tree Service', 'Irrigation', 'Hardscaping', 'Seasonal Cleanup', 'Mulching', 'Sod Installation'],
            cleaning: ['House Cleaning', 'Deep Cleaning', 'Move-in/Move-out', 'Office Cleaning', 'Window Cleaning', 'Carpet Cleaning', 'Post-Construction', 'Recurring Service'],
            dental: ['Cleanings', 'Fillings', 'Crowns', 'Root Canals', 'Teeth Whitening', 'Invisalign', 'Implants', 'Emergency Dental'],
            medical: ['Annual Physicals', 'Sick Visits', 'Preventive Care', 'Chronic Disease Management', 'Immunizations', 'Lab Work', 'Referrals', 'Telehealth'],
            medspa: ['Botox', 'Fillers', 'Laser Treatments', 'Chemical Peels', 'Microneedling', 'Body Contouring', 'IV Therapy', 'Consultations'],
            legal: ['Free Consultation', 'Case Review', 'Document Preparation', 'Court Representation', 'Mediation', 'Legal Advice', 'Contract Review', 'Estate Planning'],
            automotive: ['Oil Change', 'Brake Service', 'Tire Service', 'Engine Repair', 'Transmission Service', 'AC Service', 'Diagnostics', 'Inspection'],
            salon: ['Haircut', 'Color', 'Highlights', 'Blowout', 'Styling', 'Treatments', 'Manicure', 'Pedicure'],
            default: ['General Service', 'Consultation', 'Estimate', 'Repair', 'Installation', 'Maintenance', 'Emergency Service', 'Follow-up']
        };

        async function init() {
            const response = await fetch('/api/auth/me');
            const data = await response.json();

            if (!data.authenticated) {
                window.location.href = '/signup';
                return;
            }

            if (data.businesses && data.businesses.length > 0) {
                businessId = data.businesses[0].id;
                const biz = data.businesses[0];
                if (biz.name) document.getElementById('name').value = biz.name;
                if (biz.industry) {
                    document.getElementById('industry').value = biz.industry;
                    updateServicesForIndustry(biz.industry);
                }
                if (biz.notification_email) document.getElementById('notification_email').value = biz.notification_email;
            }

            // Listen for industry change
            document.getElementById('industry').addEventListener('change', (e) => {
                updateServicesForIndustry(e.target.value);
            });
        }

        function updateServicesForIndustry(industry) {
            const services = industryServices[industry] || industryServices.default;
            const container = document.getElementById('serviceCheckboxes');

            container.innerHTML = services.map(service => `
                <label class="flex items-center p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition">
                    <input type="checkbox" value="${service}" class="service-checkbox rounded border-gray-300 text-primary-600 focus:ring-primary-500">
                    <span class="ml-2 text-sm text-gray-700">${service}</span>
                </label>
            `).join('');
        }

        function showStep(step) {
            document.querySelectorAll('.step-content').forEach(el => el.classList.add('hidden'));
            document.querySelector(`.step-content[data-step="${step}"]`).classList.remove('hidden');

            // Update progress bar
            const progressPercent = (step / totalSteps) * 100;
            document.getElementById('progressBar').style.width = progressPercent + '%';
            document.getElementById('progressText').textContent = `Step ${step} of ${totalSteps}`;
            document.getElementById('progressPercent').textContent = Math.round(progressPercent) + '%';

            // Update step labels
            document.querySelectorAll('.step-label').forEach(el => {
                const s = parseInt(el.dataset.step);
                const circle = el.querySelector('div');
                const label = el.querySelector('span');

                if (s < step) {
                    circle.className = 'w-8 h-8 rounded-full bg-primary-600 text-white flex items-center justify-center text-xs font-semibold mx-auto';
                    circle.innerHTML = '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>';
                    label.className = 'text-xs font-medium mt-1 block text-primary-600';
                } else if (s === step) {
                    circle.className = 'w-8 h-8 rounded-full bg-primary-600 text-white flex items-center justify-center text-xs font-semibold mx-auto';
                    circle.textContent = s;
                    label.className = 'text-xs font-medium mt-1 block text-primary-600';
                } else {
                    circle.className = 'w-8 h-8 rounded-full bg-gray-200 text-gray-400 flex items-center justify-center text-xs font-semibold mx-auto';
                    circle.textContent = s;
                    label.className = 'text-xs font-medium mt-1 block text-gray-400';
                }
            });

            document.getElementById('prevBtn').classList.toggle('hidden', step === 1);

            const nextBtn = document.getElementById('nextBtn');
            if (step === totalSteps) {
                nextBtn.textContent = 'Launch my AI agent';
                nextBtn.className = 'px-6 py-2.5 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 focus:ring-4 focus:ring-green-100 transition';
                updateSummary();
            } else {
                nextBtn.textContent = 'Continue';
                nextBtn.className = 'px-6 py-2.5 bg-primary-600 text-white rounded-lg text-sm font-medium hover:bg-primary-700 focus:ring-4 focus:ring-primary-100 transition';
            }
        }

        function collectStepData(step) {
            const data = {};
            if (step === 1) {
                data.name = document.getElementById('name').value;
                data.industry = document.getElementById('industry').value;
                data.phone = document.getElementById('phone').value;
                data.service_area = document.getElementById('service_area').value;
            } else if (step === 2) {
                // Collect checked services
                const selectedServices = Array.from(document.querySelectorAll('.service-checkbox:checked')).map(cb => cb.value);
                const otherServices = document.getElementById('other_services').value;
                if (otherServices) {
                    selectedServices.push(...otherServices.split(',').map(s => s.trim()).filter(s => s));
                }
                data.services = selectedServices.join(', ');

                // Business hours
                const weekday = document.getElementById('hours_weekday').value;
                const weekend = document.getElementById('hours_weekend').value;
                data.business_hours = `Monday-Friday: ${weekday}, Saturday-Sunday: ${weekend}`;
            } else if (step === 3) {
                // Call mode selection
                data.call_mode = document.querySelector('input[name="call_mode"]:checked').value;
                data.rings_before_ai = document.getElementById('rings_before_ai').value;

                // Emergency dispatch settings
                data.emergency_dispatch = document.getElementById('emergency_dispatch').checked;
                if (data.emergency_dispatch) {
                    data.oncall_phones = document.getElementById('oncall_phones').value;
                    data.emergency_keywords = document.getElementById('emergency_keywords').value;
                }
            } else if (step === 4) {
                data.agent_name = document.getElementById('agent_name').value;
                data.agent_voice = document.querySelector('input[name="agent_voice"]:checked').value;
                data.appointment_types = Array.from(document.querySelectorAll('.appointment-type:checked')).map(cb => cb.value);
            } else if (step === 5) {
                data.notification_email = document.getElementById('notification_email').value;
                data.notification_phone = document.getElementById('notification_phone').value;
            }
            return data;
        }

        async function saveStep(step) {
            const data = collectStepData(step);
            Object.assign(formData, data);

            try {
                const response = await fetch(`/api/onboarding/${businessId}/step`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ step, data })
                });
                return response.ok;
            } catch (e) {
                console.error('Save error:', e);
                return false;
            }
        }

        async function completeOnboarding() {
            document.getElementById('loadingModal').classList.remove('hidden');

            try {
                const response = await fetch(`/api/onboarding/${businessId}/complete`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                const data = await response.json();

                if (data.success) {
                    window.location.href = data.redirect || '/dashboard';
                } else {
                    alert('Error creating agent: ' + (data.error || 'Unknown error'));
                    document.getElementById('loadingModal').classList.add('hidden');
                }
            } catch (e) {
                alert('Error: ' + e.message);
                document.getElementById('loadingModal').classList.add('hidden');
            }
        }

        function updateSummary() {
            const summary = document.getElementById('summary');
            const industrySelect = document.getElementById('industry');
            const industryText = industrySelect.options[industrySelect.selectedIndex]?.text || formData.industry || 'Not set';

            const appointmentTypes = formData.appointment_types || [];
            const callModeText = formData.call_mode === 'takeover' ? 'Full Takeover' : 'Call Forwarding';

            summary.innerHTML = `
                <div class="flex justify-between text-sm">
                    <span class="text-gray-500">Business</span>
                    <span class="font-medium text-gray-900">${formData.name || 'Not set'}</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-gray-500">Industry</span>
                    <span class="font-medium text-gray-900">${industryText}</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-gray-500">Call Mode</span>
                    <span class="font-medium text-gray-900">${callModeText}</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-gray-500">AI Agent</span>
                    <span class="font-medium text-gray-900">${formData.agent_name || 'Alex'} (${formData.agent_voice || 'Rachel'})</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-gray-500">Services</span>
                    <span class="font-medium text-gray-900">${formData.services ? formData.services.split(',').length + ' selected' : 'None'}</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-gray-500">Appointment types</span>
                    <span class="font-medium text-gray-900">${appointmentTypes.length} enabled</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-gray-500">Emergency Dispatch</span>
                    <span class="font-medium text-gray-900">${formData.emergency_dispatch ? 'Enabled' : 'Disabled'}</span>
                </div>
            `;
        }

        // Voice selection handling
        document.querySelectorAll('.voice-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.voice-option').forEach(opt => {
                    opt.classList.remove('border-primary-500', 'bg-primary-50');
                    opt.classList.add('border-gray-200');
                    opt.querySelector('.check-icon').classList.add('hidden');
                });

                option.classList.remove('border-gray-200');
                option.classList.add('border-primary-500', 'bg-primary-50');
                option.querySelector('.check-icon').classList.remove('hidden');
            });
        });

        document.getElementById('nextBtn').addEventListener('click', async () => {
            await saveStep(currentStep);

            if (currentStep === totalSteps) {
                await completeOnboarding();
            } else {
                currentStep++;
                showStep(currentStep);
            }
        });

        document.getElementById('prevBtn').addEventListener('click', () => {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        });

        // Call mode selection handling
        document.querySelectorAll('.call-mode-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.call-mode-option').forEach(opt => {
                    opt.classList.remove('border-primary-500', 'bg-primary-50');
                    opt.classList.add('border-gray-200');
                    opt.querySelector('.check-icon').classList.add('hidden');
                });

                option.classList.remove('border-gray-200');
                option.classList.add('border-primary-500', 'bg-primary-50');
                option.querySelector('.check-icon').classList.remove('hidden');

                // Show/hide forwarding section based on mode
                const mode = option.dataset.mode;
                const forwardingSection = document.getElementById('forwardingSection');
                if (mode === 'takeover') {
                    forwardingSection.classList.add('hidden');
                } else {
                    forwardingSection.classList.remove('hidden');
                }
            });
        });

        // Emergency dispatch toggle handling
        document.getElementById('emergency_dispatch').addEventListener('change', (e) => {
            const onCallSection = document.getElementById('onCallSection');
            if (e.target.checked) {
                onCallSection.classList.remove('hidden');
            } else {
                onCallSection.classList.add('hidden');
            }
        });

        init();
        showStep(1);
    </script>
</body>
</html>
